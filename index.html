<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Learning Signals - Transcript Analysis Platform</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <style>
    :root {
      --bg: #0d1117;
      --card: #161b22;
      --text: #e6edf3;
      --muted: #7d8590;
      --border: rgba(240, 246, 252, 0.1);
      --accent: #2f81f7;
      --accent2: #238636;
      --success: #3fb950;
      --radius: 12px;
      --sans: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    }
    * {box-sizing: border-box; margin: 0; padding: 0;}
    body {font-family: var(--sans); color: var(--text); background: var(--bg); min-height: 100vh;}
    .wrap {max-width: 1440px; margin: 0 auto;}
    
    .header {
      background: linear-gradient(180deg, #161b22 0%, #0d1117 100%);
      border-bottom: 1px solid var(--border);
      padding: 18px 32px;
      position: sticky;
      top: 0;
      z-index: 100;
    }
    .header-content {display: flex; justify-content: space-between; align-items: center;}
    .logo {display: flex; align-items: center; gap: 12px;}
    .logo-icon {
      font-size: 28px;
      filter: drop-shadow(0 2px 8px rgba(47, 129, 247, 0.4));
    }
    .logo-text h1 {font-size: 20px; margin: 0; font-weight: 700;}
    .logo-text p {color: var(--muted); font-size: 13px; margin-top: 2px;}
    .header-tags {display: flex; gap: 8px;}
    .tag {
      padding: 6px 12px;
      background: rgba(47, 129, 247, .15);
      border: 1px solid rgba(47, 129, 247, .3);
      border-radius: 16px;
      font-size: 11px;
      font-weight: 600;
      color: var(--accent);
      text-transform: uppercase;
      letter-spacing: .5px;
    }
    
    .main {display: grid; grid-template-columns: 320px 1fr; min-height: calc(100vh - 73px);}
    @media (max-width: 1200px) {.main {grid-template-columns: 1fr;}}
    
    .sidebar {
      background: var(--card);
      border-right: 1px solid var(--border);
      padding: 20px;
      overflow-y: auto;
    }
    .section-title {
      font-size: 13px;
      margin: 0 0 14px;
      padding-bottom: 8px;
      border-bottom: 1px solid var(--border);
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: .5px;
      color: var(--muted);
    }
    .kpi-grid {display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 16px;}
    .kpi-box {
      padding: 14px;
      background: rgba(47, 129, 247, .08);
      border: 1px solid rgba(47, 129, 247, .2);
      border-radius: 10px;
      text-align: center;
    }
    .kpi-num {font-size: 28px; font-weight: 800; color: var(--accent); margin-bottom: 4px;}
    .kpi-label {color: var(--muted); font-size: 10px; text-transform: uppercase; letter-spacing: .5px;}
    
    .btn {
      width: 100%;
      padding: 11px 16px;
      margin: 6px 0;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      font-size: 13px;
      cursor: pointer;
      transition: all .2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    .btn-primary {background: var(--accent); color: white;}
    .btn-primary:hover:not(:disabled) {background: #1f6feb; transform: translateY(-1px);}
    .btn-success {background: var(--success); color: white;}
    .btn-success:hover:not(:disabled) {background: #2ea043; transform: translateY(-1px);}
    .btn:disabled {opacity: .5; cursor: not-allowed;}
    
    .status {
      margin: 10px 0;
      padding: 9px 11px;
      border-radius: 8px;
      background: rgba(63, 185, 80, .1);
      border: 1px solid rgba(63, 185, 80, .2);
      color: var(--success);
      font-size: 11px;
    }
    .status.error {
      background: rgba(248, 81, 73, .1);
      border: 1px solid rgba(248, 81, 73, .2);
      color: #f85149;
    }
    
    .pattern-summary {
      margin-top: 20px;
      padding: 14px;
      background: rgba(47, 129, 247, .08);
      border: 1px solid rgba(47, 129, 247, .2);
      border-radius: 8px;
    }
    .pattern-summary-title {
      font-size: 12px;
      font-weight: 700;
      color: var(--accent);
      margin-bottom: 10px;
      text-transform: uppercase;
      letter-spacing: .5px;
    }
    .pattern-badge {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 10px;
      background: rgba(0, 0, 0, .2);
      border: 1px solid var(--border);
      border-radius: 6px;
      margin-bottom: 6px;
      font-size: 11px;
    }
    .pattern-badge-name {color: var(--text); font-weight: 600;}
    .pattern-badge-count {color: var(--muted);}
    
    .content {padding: 24px 32px; overflow-y: auto; max-height: calc(100vh - 73px);}
    .tabs {display: flex; gap: 4px; margin-bottom: 20px; border-bottom: 1px solid var(--border);}
    .tab {
      padding: 11px 18px;
      background: transparent;
      border: none;
      color: var(--muted);
      cursor: pointer;
      border-bottom: 2px solid transparent;
      transition: all .2s;
      font-size: 14px;
      font-weight: 600;
    }
    .tab.active {color: var(--text); border-bottom-color: var(--accent);}
    .tab-content {display: none;}
    .tab-content.active {display: block;}
    
    .dashboard-grid {display: grid; grid-template-columns: repeat(4, 1fr); gap: 14px; margin-bottom: 20px;}
    @media (max-width: 1200px) {.dashboard-grid {grid-template-columns: repeat(2, 1fr);}}
    .stat-card {padding: 18px; background: var(--card); border: 1px solid var(--border); border-radius: 12px;}
    .stat-value {font-size: 34px; font-weight: 800; color: var(--accent); margin-bottom: 6px;}
    .stat-label {color: var(--muted); font-size: 11px; text-transform: uppercase; letter-spacing: .5px;}
    
    .chart-row {display: grid; grid-template-columns: 2fr 1fr; gap: 18px; margin-bottom: 20px;}
    .chart-container {background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 18px;}
    .chart-title {font-size: 15px; font-weight: 700; margin-bottom: 14px; color: var(--text);}
    
    .data-table-container {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 18px;
      margin-top: 20px;
    }
    .table-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 14px;
    }
    .filter-group {display: flex; gap: 6px;}
    .filter-btn {
      padding: 6px 12px;
      background: rgba(255, 255, 255, .02);
      border: 1px solid var(--border);
      border-radius: 6px;
      color: var(--muted);
      font-size: 11px;
      cursor: pointer;
      transition: all .2s;
    }
    .filter-btn.active {
      background: var(--accent);
      color: white;
      border-color: var(--accent);
    }
    .data-table {width: 100%; border-collapse: collapse; font-size: 12px;}
    .data-table thead {background: rgba(0, 0, 0, .3);}
    .data-table th {
      padding: 10px 12px;
      text-align: left;
      color: var(--muted);
      font-weight: 600;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: .3px;
      border-bottom: 1px solid var(--border);
    }
    .data-table td {
      padding: 10px 12px;
      border-bottom: 1px solid var(--border);
      color: var(--text);
    }
    .data-table tbody tr:hover {background: rgba(255, 255, 255, .02);}
    .pattern-label {
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 10px;
      font-weight: 600;
      display: inline-block;
    }
    .pattern-label-0 {background: rgba(47, 129, 247, .2); color: #6ea8fe;}
    .pattern-label-1 {background: rgba(63, 185, 80, .2); color: #75d989;}
    .pattern-label-2 {background: rgba(210, 153, 34, .2); color: #eab543;}
    
    .pattern-detail-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 18px;
    }
    .pattern-detail-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 1px solid var(--border);
    }
    .pattern-detail-title {font-size: 18px; font-weight: 700; color: var(--accent);}
    .pattern-detail-count {font-size: 12px; color: var(--muted);}
    .pattern-metrics {display: grid; grid-template-columns: 1fr 1fr; gap: 14px; margin: 16px 0;}
    .metric-box {
      padding: 14px;
      background: rgba(0, 0, 0, .2);
      border: 1px solid var(--border);
      border-radius: 8px;
      text-align: center;
    }
    .metric-value {font-size: 24px; font-weight: 700; color: var(--accent); margin-bottom: 4px;}
    .metric-label {font-size: 11px; color: var(--muted); text-transform: uppercase;}
    
    .keywords-compact {display: flex; flex-wrap: wrap; gap: 6px; margin: 12px 0;}
    .keyword-compact {
      padding: 5px 10px;
      background: rgba(47, 129, 247, .12);
      border: 1px solid rgba(47, 129, 247, .25);
      border-radius: 14px;
      font-size: 11px;
      color: var(--accent);
    }
    
    .insight-box {
      padding: 14px;
      background: rgba(47, 129, 247, .06);
      border-left: 3px solid var(--accent);
      border-radius: 6px;
      margin: 12px 0;
      font-size: 13px;
      line-height: 1.6;
      color: var(--text);
    }
    
    .chat-container {
      display: flex;
      flex-direction: column;
      height: calc(100vh - 200px);
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
    }
    .chat-header {
      padding: 14px 18px;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .chat-header-title {font-size: 14px; font-weight: 700; color: var(--text);}
    .chat-status {
      padding: 4px 10px;
      background: rgba(210, 153, 34, .2);
      border-radius: 12px;
      font-size: 10px;
      color: var(--warning);
      text-transform: uppercase;
      letter-spacing: .5px;
    }
    .chat-messages {flex: 1; overflow-y: auto; padding: 18px;}
    .chat-message {margin-bottom: 14px; display: flex; gap: 10px;}
    .chat-message.user {justify-content: flex-end;}
    .chat-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      flex-shrink: 0;
    }
    .chat-avatar.ai {background: linear-gradient(135deg, var(--accent), var(--accent2));}
    .chat-avatar.user {background: linear-gradient(135deg, #d29922, #f0883e);}
    .chat-bubble {
      max-width: 70%;
      padding: 11px 14px;
      border-radius: 12px;
      line-height: 1.5;
      font-size: 13px;
      white-space: pre-line;
    }
    .chat-bubble.ai {
      background: rgba(47, 129, 247, .1);
      border: 1px solid rgba(47, 129, 247, .2);
      color: var(--text);
    }
    .chat-bubble.user {background: var(--accent); color: white;}
    .chat-input-area {
      padding: 14px;
      border-top: 1px solid var(--border);
      display: flex;
      gap: 8px;
      align-items: center;
    }
    .chat-input {
      flex: 1;
      padding: 11px 14px;
      background: rgba(255, 255, 255, .05);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text);
      font-size: 13px;
      outline: none;
    }
    .chat-input:focus {border-color: var(--accent);}
    .voice-btn {
      width: 40px;
      height: 40px;
      border: none;
      background: var(--accent);
      color: white;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      transition: all .2s;
    }
    .voice-btn:hover {background: #1f6feb;}
    .voice-btn.recording {
      background: #f85149;
      animation: pulse 1s infinite;
    }
    @keyframes pulse {0%, 100% {opacity: 1;} 50% {opacity: .5;}}
    
    .guide-section {margin-bottom: 20px; padding: 18px; background: var(--card); border: 1px solid var(--border); border-radius: 12px;}
    .guide-section h3 {font-size: 16px; color: var(--accent); margin-bottom: 10px; font-weight: 700;}
    .guide-section p {color: var(--muted); line-height: 1.7; font-size: 13px; margin-bottom: 10px;}
    .guide-section ul {color: var(--muted); font-size: 13px; line-height: 1.7; margin-left: 18px; margin-bottom: 10px;}
    .guide-section strong {color: var(--text);}
    
    .empty-state {text-align: center; padding: 50px 20px; color: var(--muted);}
    .loading {text-align: center; padding: 40px;}
    .spinner {
      border: 3px solid rgba(47, 129, 247, .2);
      border-top: 3px solid var(--accent);
      border-radius: 50%;
      width: 36px;
      height: 36px;
      animation: spin 1s linear infinite;
      margin: 0 auto 14px;
    }
    @keyframes spin {0% {transform: rotate(0deg);} 100% {transform: rotate(360deg);}}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <div class="header-content">
        <div class="logo">
          <div class="logo-icon">üéì</div>
          <div class="logo-text">
            <h1>Learning Signals</h1>
            <p>Transforming Transcripts into Insights</p>
          </div>
        </div>
        <div class="header-tags">
          <span class="tag">Education</span>
          <span class="tag">Business</span>
          <span class="tag">Research</span>
        </div>
      </div>
    </div>

    <div class="main">
      <div class="sidebar">
        <div class="section-title">Data Overview</div>
        <div class="kpi-grid">
          <div class="kpi-box">
            <div class="kpi-num" id="totalTranscripts">0</div>
            <div class="kpi-label">Transcripts</div>
          </div>
          <div class="kpi-box">
            <div class="kpi-num" id="totalWords">0</div>
            <div class="kpi-label">Words</div>
          </div>
        </div>

        <button class="btn btn-success" id="loadSample">
          <span>üìù</span> Load Demo Data
        </button>
        <button class="btn btn-primary" id="analyzeBtn" disabled>
          <span>üöÄ</span> Analyze Data
        </button>
        <div class="status" id="status">Ready to analyze</div>

        <div class="pattern-summary" id="patternSummary" style="display:none">
          <div class="pattern-summary-title">Detected Patterns</div>
          <div id="patternBadges"></div>
        </div>
      </div>

      <div class="content">
        <div class="tabs">
          <button class="tab active" data-tab="dashboard">üìä Dashboard</button>
          <button class="tab" data-tab="patterns">üîç Pattern Analysis</button>
          <button class="tab" data-tab="chat">üí¨ AI Chat</button>
          <button class="tab" data-tab="guide">üìö About & Impact</button>
        </div>

        <!-- Dashboard Tab -->
        <div class="tab-content active" id="tab-dashboard">
          <div id="dashboardContent">
            <div class="empty-state">
              <div style="font-size:44px;margin-bottom:14px">üìà</div>
              <h3 style="margin-bottom:8px;font-size:17px">No Analysis Yet</h3>
              <p>Load demo data and click analyze to see insights</p>
            </div>
          </div>
        </div>

        <!-- Pattern Analysis Tab -->
        <div class="tab-content" id="tab-patterns">
          <div id="patternsContent">
            <div class="empty-state">
              <div style="font-size:44px;margin-bottom:14px">üîç</div>
              <h3 style="margin-bottom:8px;font-size:17px">No Patterns Detected</h3>
              <p>Run analysis to discover learning themes</p>
            </div>
          </div>
        </div>

        <!-- Chat Tab -->
        <div class="tab-content" id="tab-chat">
          <div class="chat-container">
            <div class="chat-header">
              <div class="chat-header-title">üí¨ AI Assistant</div>
              <div class="chat-status">UI Demo</div>
            </div>
            <div class="chat-messages" id="chatMessages">
              <div class="chat-message">
                <div class="chat-avatar ai">ü§ñ</div>
                <div class="chat-bubble ai">Hello! I'm your AI assistant for analyzing transcript data.

Once you've loaded and analyzed data, you can ask me questions like:

- "What are the main themes?"
- "Show me insights about teamwork"
- "Summarize the key patterns"

Click the microphone to use voice input, or type your question below!</div>
              </div>
            </div>
            <div class="chat-input-area">
              <input type="text" class="chat-input" id="chatInput" placeholder="Ask me about your transcripts...">
              <button class="voice-btn" id="voiceBtn" title="Voice input">üé§</button>
              <button class="btn btn-primary" id="sendBtn" style="width:auto;margin:0;padding:0 18px">Send</button>
            </div>
          </div>
        </div>

        <!-- Guide Tab -->
        <div class="tab-content" id="tab-guide">
          <div class="guide-section">
            <h3>üéØ Why Learning Signals Was Built</h3>
            <p>
              Educational institutions, businesses, and researchers generate vast amounts of qualitative data‚Äîstudent 
              reflections, interview transcripts, course feedback, employee surveys‚Äîbut analyzing this data manually is 
              time-consuming and difficult to scale.
            </p>
            <p>
              <strong>Learning Signals was created to bridge this gap.</strong> It empowers educators, researchers, and 
              organizational leaders to discover meaningful patterns in hundreds or thousands of text responses, transforming 
              raw qualitative data into actionable insights that inform teaching, learning, and organizational improvement.
            </p>
          </div>

          <div class="guide-section">
            <h3>üî¨ How It Works (Simple Explanation)</h3>
            <p><strong>Step 1: Upload Your Data</strong><br>
            Provide transcripts from interviews, reflections, or surveys in CSV format.</p>
            
            <p><strong>Step 2: Automatic Pattern Detection</strong><br>
            The system analyzes all text using advanced algorithms (TF-IDF and clustering) to find natural groupings and themes.</p>
            
            <p><strong>Step 3: AI-Powered Interpretation</strong><br>
            For each pattern discovered, AI generates human-readable insights explaining what the pattern reveals about learning, 
            behavior, or sentiment.</p>
            
            <p><strong>Step 4: Review & Validate</strong><br>
            Researchers review the patterns, keywords, and representative quotes to validate findings and guide deeper investigation.</p>
          </div>

          <div class="guide-section">
            <h3>üåü Impact on Education & Research</h3>
            <p><strong>For Educators:</strong></p>
            <ul>
              <li>Understand student learning experiences at scale (100s of reflections analyzed in minutes)</li>
              <li>Identify common challenges and successful strategies across cohorts</li>
              <li>Make data-informed decisions about course design and pedagogy</li>
              <li>Respond to student needs more quickly with timely insights</li>
            </ul>
            
            <p><strong>For Researchers:</strong></p>
            <ul>
              <li>Accelerate qualitative data analysis from weeks to hours</li>
              <li>Discover unexpected patterns and generate new hypotheses</li>
              <li>Maintain rigorous methodology while leveraging AI capabilities</li>
              <li>Scale research to larger sample sizes previously impractical</li>
            </ul>
            
            <p><strong>For Institutions & Organizations:</strong></p>
            <ul>
              <li>Process employee feedback and identify organizational themes</li>
              <li>Analyze customer interviews to understand satisfaction and pain points</li>
              <li>Support continuous improvement through systematic data analysis</li>
              <li>Bridge the gap between data collection and actionable insights</li>
            </ul>
          </div>

          <div class="guide-section">
            <h3>üë• Who Can Use Learning Signals</h3>
            <ul>
              <li><strong>University Instructors:</strong> Analyzing student reflections, course evaluations, learning journals</li>
              <li><strong>Educational Researchers:</strong> Processing interview data, qualitative studies, longitudinal research</li>
              <li><strong>K-12 Teachers:</strong> Understanding student feedback, parent communications, professional development reflections</li>
              <li><strong>Business Leaders:</strong> Analyzing customer feedback, employee engagement surveys, stakeholder input</li>
              <li><strong>HR Professionals:</strong> Processing exit interviews, performance feedback, workplace culture assessments</li>
              <li><strong>UX Researchers:</strong> Analyzing user interviews, usability feedback, product research</li>
              <li><strong>Community Organizations:</strong> Understanding participant experiences, program feedback, impact assessments</li>
            </ul>
          </div>

          <div class="guide-section">
            <h3>üöÄ From Voice AI to Insights</h3>
            <p>
              Learning Signals integrates seamlessly with voice-based AI interview systems. Organizations using voice AI 
              agents to conduct interviews (student check-ins, customer feedback sessions, employee surveys) can feed 
              transcripts directly into this platform for automated theme extraction and insight generation.
            </p>
            <p>
              <strong>Example Workflow:</strong> A university course uses AI voice agents to interview 300 students (4 interviews 
              each = 1,200 transcripts). Instead of manual review, Learning Signals processes all transcripts, identifies 5-8 
              major themes, and provides instructors with validated insights in hours instead of weeks.
            </p>
          </div>

          <div class="guide-section">
            <h3>üîê Ethical Design Principles</h3>
            <ul>
              <li><strong>Non-evaluative:</strong> Does not grade, rank, or score individual people</li>
              <li><strong>Transparent:</strong> All logic and outputs are explainable to stakeholders</li>
              <li><strong>Human-centered:</strong> Designed to support, not replace, human judgment</li>
              <li><strong>Privacy-first:</strong> Processes data securely with governance controls</li>
              <li><strong>Bias-aware:</strong> Outputs require expert validation and critical review</li>
            </ul>
          </div>

          <div class="guide-section">
            <h3>üí° The Broader Vision</h3>
            <p>
              Learning Signals represents a shift in how we approach qualitative data in education and organizations. 
              By making pattern discovery accessible and scalable, we enable evidence-based decision-making that was 
              previously limited to small-scale studies.
            </p>
            <p>
              The platform democratizes advanced analytics, allowing educators and researchers without technical backgrounds 
              to leverage AI for sensemaking while maintaining scholarly rigor and ethical standards. This creates a future 
              where data-informed improvement is the norm, not the exception.
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
const SAMPLE_DATA = [
  {id: 1, name: "STU001_Int1", text: "Working with my team on the group presentation taught me invaluable lessons about collaboration. We used shared documents and regular check-ins to stay coordinated. Each member brought different strengths and we learned to delegate effectively based on those strengths."},
  {id: 2, name: "STU001_Int2", text: "Presenting to the class was nerve-wracking at first. I practiced my delivery multiple times and focused on making eye contact. The feedback helped me understand that pausing for emphasis makes presentations more engaging and helps the audience follow along better."},
  {id: 3, name: "STU002_Int1", text: "Time management became my biggest area of growth this semester. Balancing multiple assignments while maintaining quality required strategic planning. I started using project management tools and breaking large tasks into daily milestones which made everything more manageable."},
  {id: 4, name: "STU002_Int2", text: "The iterative revision process significantly improved my business writing. Each draft incorporated feedback from peers and the instructor. I learned that professional communication requires multiple rounds of refinement and careful attention to audience needs and context."},
  {id: 5, name: "STU003_Int1", text: "Working with diverse team members expanded my understanding of business communication. Team members from different cultural backgrounds approached problems with unique frameworks. This diversity taught me to listen actively and consider multiple viewpoints before making decisions."},
  {id: 6, name: "STU003_Int2", text: "Applying communication theory to real business cases was eye-opening. Reading about stakeholder analysis is completely different from identifying actual stakeholders in case studies. This practical application made abstract concepts tangible and memorable for future use."},
  {id: 7, name: "STU004_Int1", text: "The instructor's office hours provided crucial support for understanding complex concepts. Having one-on-one time to ask questions and receive personalized explanations accelerated my learning significantly. I discovered that seeking help early prevents misunderstandings from compounding."},
  {id: 8, name: "STU004_Int2", text: "Professional networking simulations prepared me for real-world interactions. Practicing elevator pitches and informational interviews in class built confidence and competence. The structured feedback after each simulation highlighted specific areas for improvement in my communication approach."},
  {id: 9, name: "STU005_Int1", text: "Collaborative problem-solving sessions revealed important group dynamics. Some teammates naturally facilitated discussion while others excelled at detailed analysis. Understanding these complementary roles helped us work more efficiently and produce higher quality deliverables."},
  {id: 10, name: "STU005_Int2", text: "Guest speakers from various industries brought theory to life with practical examples. Hearing how professionals actually use communication strategies in their work made the course material more relevant and applicable. Their real-world examples illustrated both successful and unsuccessful communication approaches."},
  {id: 11, name: "STU006_Int1", text: "The asynchronous discussion board format suited my processing style perfectly. Having time to reflect on prompts before responding led to more thoughtful contributions. Reading classmates' diverse perspectives before formulating my own enriched my understanding of each topic significantly."},
  {id: 12, name: "STU006_Int2", text: "Video presentations required mastering new technical skills alongside communication techniques. Learning to manage camera angles, lighting, and audio quality while delivering clear messages added complexity. This multimedia approach reflects modern business communication realities and expectations."},
  {id: 13, name: "STU007_Int1", text: "Hands-on activities made business communication principles concrete and applicable. Actually drafting memos, emails, and reports reinforced formatting conventions and tone guidelines. The experiential learning approach proved far more effective than passive reading about these concepts."},
  {id: 14, name: "STU007_Int2", text: "Progressive assignments built upon previous work throughout the semester creating continuity. Early foundational concepts about audience analysis informed later projects on persuasive communication. This scaffolded approach demonstrated how professional communication skills develop cumulatively over time."},
  {id: 15, name: "STU008_Int1", text: "Setting specific learning objectives at the semester's start focused my efforts strategically. Having clear goals for improving presentation skills and written communication made progress measurable and trackable. Regular self-assessment against these objectives kept me accountable and motivated throughout."},
  {id: 16, name: "STU008_Int2", text: "Case studies from multiple industries illustrated universal communication principles across contexts. Seeing how healthcare, technology, and finance sectors all face similar stakeholder communication challenges was illuminating. The varied examples made theories applicable across diverse career paths and settings."}
];

const state = {transcripts: [], analysis: null, chartInstances: {}, currentFilter: 'all'};

function generatePatternName(kw) {
  const k = kw.map(x => x.toLowerCase());
  if (k.some(x => x.includes('team') || x.includes('group') || x.includes('collaborat'))) return "Collaboration & Teamwork";
  if (k.some(x => x.includes('feedback') || x.includes('peer') || x.includes('review') || x.includes('revis'))) return "Peer Feedback & Revision";
  if (k.some(x => x.includes('time') || x.includes('management') || x.includes('plan'))) return "Time Management";
  if (k.some(x => x.includes('present') || x.includes('speak') || x.includes('deliver'))) return "Presentation Skills";
  if (k.some(x => x.includes('theory') || x.includes('practice') || x.includes('case') || x.includes('apply'))) return "Theory to Practice";
  if (k.some(x => x.includes('writ') || x.includes('draft'))) return "Writing Development";
  if (k.some(x => x.includes('learn') || x.includes('understand'))) return "Learning Process";
  return "Learning Theme";
}

function generateInsight(kw) {
  const n = generatePatternName(kw);
  if (n.includes("Collaboration")) return "Students emphasize teamwork, coordination, and leveraging diverse perspectives in group work.";
  if (n.includes("Feedback")) return "Peer review and iterative improvement are key to quality work and deeper learning.";
  if (n.includes("Time")) return "Strategic planning and prioritization help balance multiple commitments effectively.";
  if (n.includes("Presentation")) return "Practice and feedback build confidence and improve delivery techniques significantly.";
  if (n.includes("Theory")) return "Real-world applications and case studies make abstract concepts tangible and memorable.";
  if (n.includes("Writing")) return "Revision processes and feedback integration enhance communication abilities.";
  if (n.includes("Learning")) return "Metacognitive awareness about learning processes drives deeper comprehension.";
  return `This pattern centers on: ${kw.slice(0, 3).join(', ')}.`;
}

function escapeHTML(str) {
  return String(str).replaceAll("&", "&amp;").replaceAll("<", "&lt;").replaceAll(">", "&gt;").replaceAll('"', "&quot;");
}

function updateDashboard() {
  document.getElementById('totalTranscripts').textContent = state.transcripts.length;
  const w = state.transcripts.reduce((s, t) => s + t.text.split(' ').length, 0);
  document.getElementById('totalWords').textContent = w.toLocaleString();
  document.getElementById('analyzeBtn').disabled = state.transcripts.length === 0;
}

function updatePatternSummary() {
  if (!state.analysis) {
    document.getElementById('patternSummary').style.display = 'none';
    return;
  }
  
  document.getElementById('patternSummary').style.display = 'block';
  const {patternNames, counts} = state.analysis;
  const badges = document.getElementById('patternBadges');
  
  badges.innerHTML = patternNames.map((name, i) => `
    <div class="pattern-badge">
      <span class="pattern-badge-name">${name}</span>
      <span class="pattern-badge-count">${counts[i]} items</span>
    </div>
  `).join('');
}

function renderDashboard() {
  const c = document.getElementById('dashboardContent');
  if (!state.analysis) return;

  const {labels, keywords, counts, texts, patternNames} = state.analysis;

  Object.values(state.chartInstances).forEach(ch => ch.destroy());
  state.chartInstances = {};

  c.innerHTML = `
    <div class="dashboard-grid">
      <div class="stat-card">
        <div class="stat-value">${texts.length}</div>
        <div class="stat-label">Total Transcripts</div>
      </div>
      <div class="stat-card">
        <div class="stat-value">${keywords.length}</div>
        <div class="stat-label">Patterns Found</div>
      </div>
      <div class="stat-card">
        <div class="stat-value">${keywords.flat().length}</div>
        <div class="stat-label">Keywords</div>
      </div>
      <div class="stat-card">
        <div class="stat-value">${texts.reduce((s, t) => s + t.split(' ').length, 0)}</div>
        <div class="stat-label">Words</div>
      </div>
    </div>

    <div class="chart-row">
      <div class="chart-container">
        <div class="chart-title">Pattern Distribution</div>
        <canvas id="barChart" height="100"></canvas>
      </div>
      <div class="chart-container">
        <div class="chart-title">Theme Breakdown</div>
        <canvas id="pieChart"></canvas>
      </div>
    </div>

    <div class="data-table-container">
      <div class="table-header">
        <div class="chart-title">Transcript Data</div>
        <div class="filter-group">
          <button class="filter-btn active" data-filter="all">All</button>
          ${patternNames.map((_, i) => `<button class="filter-btn" data-filter="${i}">Pattern ${i + 1}</button>`).join('')}
        </div>
      </div>
      <div style="max-height:400px;overflow-y:auto">
        <table class="data-table">
          <thead>
            <tr>
              <th style="width:60px">#</th>
              <th style="width:140px">Name</th>
              <th style="width:180px">Pattern</th>
              <th>Text Preview</th>
              <th style="width:80px">Words</th>
            </tr>
          </thead>
          <tbody id="tableBody"></tbody>
        </table>
      </div>
    </div>
  `;

  renderTable();

  const barCtx = document.getElementById('barChart').getContext('2d');
  state.chartInstances.bar = new Chart(barCtx, {
    type: 'bar',
    data: {
      labels: patternNames,
      datasets: [{
        label: 'Transcripts',
        data: Object.values(counts),
        backgroundColor: 'rgba(47, 129, 247, 0.7)',
        borderColor: 'rgba(47, 129, 247, 1)',
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: true,
      plugins: {legend: {display: false}},
      scales: {
        y: {beginAtZero: true, ticks: {color: '#7d8590'}, grid: {color: 'rgba(240,246,252,0.05)'}},
        x: {ticks: {color: '#7d8590', maxRotation: 45}, grid: {color: 'rgba(240,246,252,0.05)'}}
      }
    }
  });

  const pieCtx = document.getElementById('pieChart').getContext('2d');
  state.chartInstances.pie = new Chart(pieCtx, {
    type: 'doughnut',
    data: {
      labels: patternNames,
      datasets: [{
        data: Object.values(counts),
        backgroundColor: ['rgba(47,129,247,0.8)', 'rgba(63,185,80,0.8)', 'rgba(210,153,34,0.8)'],
        borderWidth: 2,
        borderColor: '#161b22'
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: true,
      plugins: {legend: {position: 'bottom', labels: {color: '#7d8590', padding: 8, font: {size: 10}}}}
    }
  });

  document.querySelectorAll('.filter-btn').forEach(btn => {
    btn.addEventListener('click', (e) => {
      document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
      e.target.classList.add('active');
      state.currentFilter = e.target.dataset.filter;
      renderTable();
    });
  });
}

function renderTable() {
  const tbody = document.getElementById('tableBody');
  if (!tbody) return;
  
  const {labels, texts, patternNames} = state.analysis;
  
  const filteredData = texts.map((text, i) => ({
    idx: i,
    name: state.transcripts[i].name,
    pattern: labels[i],
    patternName: patternNames[labels[i]],
    text: text,
    words: text.split(' ').length
  })).filter(item => state.currentFilter === 'all' || item.pattern === parseInt(state.currentFilter));

  tbody.innerHTML = filteredData.map((item, i) => {
    const preview = item.text.substring(0, 80) + '...';
    return `
      <tr>
        <td>${i + 1}</td>
        <td>${escapeHTML(item.name)}</td>
        <td><span class="pattern-label pattern-label-${item.pattern}">${escapeHTML(item.patternName)}</span></td>
        <td style="color:var(--muted)">${escapeHTML(preview)}</td>
        <td style="text-align:center">${item.words}</td>
      </tr>
    `;
  }).join('');
}

function renderPatterns() {
  const c = document.getElementById('patternsContent');
  if (!state.analysis) return;

  const {keywords, insights, reps, counts, patternNames, labels, texts} = state.analysis;

  let html = '';
  for (let i = 0; i < keywords.length; i++) {
    const patternTexts = texts.filter((_, idx) => labels[idx] === i);
    const avgWords = Math.round(patternTexts.reduce((s, t) => s + t.split(' ').length, 0) / patternTexts.length);
    
    html += `
      <div class="pattern-detail-card">
        <div class="pattern-detail-header">
          <div class="pattern-detail-title">${patternNames[i]}</div>
          <div class="pattern-detail-count">${counts[i]} transcripts</div>
        </div>

        <div class="pattern-metrics">
          <div class="metric-box">
            <div class="metric-value">${counts[i]}</div>
            <div class="metric-label">Transcripts</div>
          </div>
          <div class="metric-box">
            <div class="metric-value">${avgWords}</div>
            <div class="metric-label">Avg Words</div>
          </div>
        </div>

        <div class="keywords-compact">
          ${keywords[i].map(kw => `<span class="keyword-compact">${escapeHTML(kw)}</span>`).join("")}
        </div>

        <div class="insight-box">
          <strong>Key Insight:</strong> ${escapeHTML(insights[i])}
        </div>

        <div style="margin-top:16px">
          <div style="font-size:12px;font-weight:600;color:var(--muted);margin-bottom:10px;text-transform:uppercase;letter-spacing:.5px">Representative Examples:</div>
          ${(reps[i] || []).map(q => `
            <div style="padding:10px 12px;background:rgba(63,185,80,.06);border-left:2px solid var(--success);border-radius:6px;font-size:12px;line-height:1.5;color:var(--muted);margin-bottom:8px;font-style:italic">"${escapeHTML(q)}"</div>
          `).join("")}
        </div>
      </div>
    `;
  }

  c.innerHTML = html;
  updatePatternSummary();
}

function cleanText(s) {
  return String(s || "").toLowerCase().replace(/https?:\/\/\S+/g, " ").replace(/[^a-z0-9\s']/g, " ").replace(/\s+/g, " ").trim();
}

function tokenize(s) {
  const stop = new Set(["the", "a", "an", "and", "or", "but", "if", "then", "else", "when", "while", "to", "of", "in", "on", "for", "with", "as", "at", "by", "is", "are", "was", "were", "be", "been", "being", "it", "this", "that", "these", "those", "i", "we", "you", "they", "he", "she", "my", "our", "your", "their", "me", "us", "him", "her", "them", "from", "into", "about", "over", "under", "again", "very", "really", "just", "so", "because", "can", "could", "should", "would", "will", "did", "do", "does", "done", "than", "too", "also", "not"]);
  return s.split(" ").map(t => t.trim()).filter(t => t.length >= 3 && !stop.has(t));
}

function buildVocab(docs) {
  const df = new Map();
  const tdocs = [];
  docs.forEach(d => {
    const toks = tokenize(cleanText(d));
    const uniq = new Set(toks);
    uniq.forEach(t => df.set(t, (df.get(t) || 0) + 1));
    tdocs.push(toks);
  });
  const terms = [...df.entries()].filter(([t, c]) => c >= 1).sort((a, b) => b[1] - a[1]).slice(0, 2500).map(([t]) => t);
  const idx = new Map();
  terms.forEach((t, i) => idx.set(t, i));
  return {terms, idx, tdocs};
}

function tfidfMatrix(tdocs, terms, idx) {
  const N = tdocs.length;
  const df = new Array(terms.length).fill(0);
  const tf = tdocs.map(toks => {
    const counts = new Map();
    toks.forEach(t => {
      if (idx.has(t)) counts.set(t, (counts.get(t) || 0) + 1);
    });
    counts.forEach((v, t) => {df[idx.get(t)] += 1;});
    return counts;
  });
  const idf = df.map(dfi => Math.log((N + 1) / (dfi + 1)) + 1);
  const X = tf.map(counts => {
    const vec = new Array(terms.length).fill(0);
    counts.forEach((v, t) => {
      const j = idx.get(t);
      vec[j] = v * idf[j];
    });
    const norm = Math.sqrt(vec.reduce((s, x) => s + x * x, 0)) || 1;
    for (let j = 0; j < vec.length; j++) vec[j] /= norm;
    return vec;
  });
  return {X};
}

function cosineDistance(a, b) {
  let dot = 0;
  for (let i = 0; i < a.length; i++) dot += a[i] * b[i];
  return 1 - dot;
}

function kmeans(X, k, iters = 25) {
  const n = X.length;
  const d = X[0].length;
  const idxs = [...Array(n).keys()];
  for (let i = idxs.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [idxs[i], idxs[j]] = [idxs[j], idxs[i]];
  }
  let centers = idxs.slice(0, k).map(i => X[i].slice());
  let labels = new Array(n).fill(0);
  for (let it = 0; it < iters; it++) {
    let changed = false;
    for (let i = 0; i < n; i++) {
      let best = 0, bestDist = Infinity;
      for (let c = 0; c < k; c++) {
        const dist = cosineDistance(X[i], centers[c]);
        if (dist < bestDist) {bestDist = dist; best = c;}
      }
      if (labels[i] !== best) {labels[i] = best; changed = true;}
    }
    const newCenters = Array.from({length: k}, () => new Array(d).fill(0));
    const cnts = new Array(k).fill(0);
    for (let i = 0; i < n; i++) {
      const c = labels[i];
      cnts[c] += 1;
      const xi = X[i];
      for (let j = 0; j < d; j++) newCenters[c][j] += xi[j];
    }
    for (let c = 0; c < k; c++) {
      if (cnts[c] === 0) continue;
      for (let j = 0; j < d; j++) newCenters[c][j] /= cnts[c];
      const norm = Math.sqrt(newCenters[c].reduce((s, x) => s + x * x, 0)) || 1;
      for (let j = 0; j < d; j++) newCenters[c][j] /= norm;
    }
    centers = newCenters;
    if (!changed) break;
  }
  return {labels, centers};
}

function topKeywordsForCluster(centers, terms, topN) {
  return centers.map(center => {
    const pairs = center.map((w, i) => [i, w]);
    pairs.sort((a, b) => b[1] - a[1]);
    return pairs.slice(0, topN).map(([i]) => terms[i]);
  });
}

function representativeQuotes(X, labels, centers, texts, per) {
  const reps = [];
  for (let c = 0; c < centers.length; c++) {
    const items = [];
    for (let i = 0; i < X.length; i++) {
      if (labels[i] !== c) continue;
      const dist = cosineDistance(X[i], centers[c]);
      items.push([dist, i]);
    }
    items.sort((a, b) => a[0] - b[0]);
    reps[c] = items.slice(0, per).map(([, i]) => texts[i]);
  }
  return reps;
}

function runAnalysis() {
  const texts = state.transcripts.map(t => t.text);
  const k = 3;

  document.getElementById('status').textContent = 'Analyzing...';
  document.getElementById('dashboardContent').innerHTML = '<div class="loading"><div class="spinner"></div><p>Processing data...</p></div>';

  setTimeout(() => {
    try {
      const {terms, idx, tdocs} = buildVocab(texts);
      if (terms.length < 5) {
        document.getElementById('status').textContent = 'Not enough data';
        document.getElementById('status').classList.add('error');
        return;
      }

      const {X} = tfidfMatrix(tdocs, terms, idx);
      const {labels, centers} = kmeans(X, k, 25);
      const keywords = topKeywordsForCluster(centers, terms, 6);
      const reps = representativeQuotes(X, labels, centers, texts, 2);
      const patternNames = keywords.map(generatePatternName);
      const insights = keywords.map(generateInsight);
      const counts = labels.reduce((acc, l) => {
        acc[l] = (acc[l] || 0) + 1;
        return acc;
      }, {});

      state.analysis = {labels, keywords, reps, insights, counts, texts, patternNames};

      renderDashboard();
      renderPatterns();

      document.getElementById('status').textContent = '‚úì Complete';
      document.getElementById('status').classList.remove('error');
    } catch (err) {
      console.error(err);
      document.getElementById('status').textContent = 'Error';
      document.getElementById('status').classList.add('error');
    }
  }, 500);
}

function renderTable() {
  const tbody = document.getElementById('tableBody');
  if (!tbody) return;
  
  const {labels, texts, patternNames} = state.analysis;
  
  const filtered = texts.map((text, i) => ({
    idx: i,
    name: state.transcripts[i].name,
    pattern: labels[i],
    patternName: patternNames[labels[i]],
    text: text,
    words: text.split(' ').length
  })).filter(item => state.currentFilter === 'all' || item.pattern === parseInt(state.currentFilter));

  tbody.innerHTML = filtered.map((item, i) => {
    const preview = item.text.substring(0, 70) + '...';
    return `
      <tr>
        <td>${i + 1}</td>
        <td>${escapeHTML(item.name)}</td>
        <td><span class="pattern-label pattern-label-${item.pattern}">${escapeHTML(item.patternName)}</span></td>
        <td style="color:var(--muted)">${escapeHTML(preview)}</td>
        <td style="text-align:center">${item.words}</td>
      </tr>
    `;
  }).join('');
}

function addChatMessage(type, text) {
  const c = document.getElementById('chatMessages');
  const m = document.createElement('div');
  m.className = `chat-message ${type}`;
  if (type === 'ai') {
    m.innerHTML = `<div class="chat-avatar ai">ü§ñ</div><div class="chat-bubble ai">${escapeHTML(text)}</div>`;
  } else {
    m.innerHTML = `<div class="chat-bubble user">${escapeHTML(text)}</div><div class="chat-avatar user">üë§</div>`;
  }
  c.appendChild(m);
  c.scrollTop = c.scrollHeight;
}

function handleChat(msg) {
  addChatMessage('user', msg);
  setTimeout(() => {
    addChatMessage('ai', 'Chat feature is currently in development. API integration will enable real-time transcript querying and insights generation. For now, please use the Dashboard and Pattern Analysis tabs to explore your data.');
  }, 500);
}

let recognition;
if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
  const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
  recognition = new SR();
  recognition.continuous = false;
  recognition.onresult = (e) => {
    const t = e.results[0][0].transcript;
    document.getElementById('chatInput').value = t;
    document.getElementById('voiceBtn').classList.remove('recording');
  };
  recognition.onerror = () => {document.getElementById('voiceBtn').classList.remove('recording');};
  recognition.onend = () => {document.getElementById('voiceBtn').classList.remove('recording');};
}

document.getElementById('loadSample').addEventListener('click', () => {
  state.transcripts = [...SAMPLE_DATA];
  updateDashboard();
  document.getElementById('status').textContent = '‚úì Loaded 16 transcripts';
  document.getElementById('status').classList.remove('error');
});

document.getElementById('analyzeBtn').addEventListener('click', runAnalysis);

document.getElementById('sendBtn').addEventListener('click', () => {
  const input = document.getElementById('chatInput');
  const msg = input.value.trim();
  if (msg) {
    handleChat(msg);
    input.value = '';
  }
});

document.getElementById('chatInput').addEventListener('keypress', (e) => {
  if (e.key === 'Enter') document.getElementById('sendBtn').click();
});

document.getElementById('voiceBtn').addEventListener('click', () => {
  if (recognition) {
    const btn = document.getElementById('voiceBtn');
    if (btn.classList.contains('recording')) {
      recognition.stop();
    } else {
      btn.classList.add('recording');
      recognition.start();
    }
  } else {
    alert('Voice not supported. Use Chrome or Safari.');
  }
});

document.querySelectorAll('.tab').forEach(tab => {
  tab.addEventListener('click', () => {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
    tab.classList.add('active');
    document.getElementById(`tab-${tab.dataset.tab}`).classList.add('active');
  });
});

updateDashboard();
</script>
</body>
</html>
